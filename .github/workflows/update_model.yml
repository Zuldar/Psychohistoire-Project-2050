name: Mise √† jour Mensuelle Psychohistoire

on:
  schedule:
    - cron: '0 8 1 * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  run-model:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• R√©cup√©ration du d√©p√¥t
      uses: actions/checkout@v3

    - name: üêç Installation de Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: üß† Ex√©cution du mod√®le Psychohistorique
      run: |
        python src/Seldon.py

    - name: üíæ Commit et Push (Mode Robuste)
      run: |
        git config --global user.name 'Psychohistory Bot'
        git config --global user.email 'bot@psychohistory.com'
        
        # On ajoute TOUS les fichiers modifi√©s (plus simple)
        git add .
        
        # On v√©rifie s'il y a des changements √† sauvegarder
        if git diff --staged --quiet; then
          echo "Aucun changement d√©tect√©. Tout est √† jour."
        else
          git commit -m "üîÆ Mise √† jour : Projection Seldon 2036"
          
          # C'EST ICI QUE LA MAGIE OP√àRE : On r√©cup√®re tes modifs avant d'envoyer
          git pull --rebase origin main
          
          git push origin HEAD:main
     
        fi
