<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seldon Project | Prime Radiant</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        #error-box { display: none; background: rgba(255,0,0,0.2); border: 2px solid red; color: #fff; padding: 20px; margin: 20px 0; font-family: monospace; z-index:9999; position:relative; }
        
        /* STYLE ARCHIVES V31 - LISTE */
        .archives-box { margin-top: 40px; border-top: 1px solid var(--glass-border); padding-top: 20px; color: #888; font-family: 'Share Tech Mono'; font-size: 0.85rem; }
        .archive-item { 
            display: flex; align-items: center; gap: 10px; margin-bottom: 8px; padding: 5px; 
            border-bottom: 1px solid rgba(255,255,255,0.05); transition:0.3s;
        }
        .archive-item:hover { background: rgba(255,255,255,0.02); color: #fff; }
        .archive-year { color: var(--neon-red); font-weight: bold; font-family: 'Orbitron'; min-width: 60px; }
        .archive-score { color: #555; font-size: 0.8em; margin-right: 10px; }
        .archive-desc { color: #aaa; font-style: italic; }
        
        .accuracy-box { position: absolute; top: 20px; right: 20px; text-align: right; }
        .accuracy-label { font-size: 0.7em; color: #555; font-family: 'Share Tech Mono'; letter-spacing: 1px; }
        .accuracy-val { font-family: 'Orbitron'; font-size: 1.2em; font-weight: bold; }
        @media (max-width: 600px) { .accuracy-box { position: relative; top: 0; right: 0; text-align: center; margin-top: 10px; } }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div>
                <h1>SELDON PROJECT</h1>
                <div style="color: var(--neon-blue); letter-spacing: 4px; font-size: 0.8rem; font-family: 'Share Tech Mono';">PRIME RADIANT TERMINAL</div>
            </div>
            <div class="accuracy-box">
                <div class="accuracy-label">RADIANT ACCURACY</div>
                <div id="model-accuracy" class="accuracy-val">--%</div>
            </div>
            <div id="last-update" class="status-pill">INITIALIZING...</div>
        </header>

        <div id="error-box"></div>

        <div class="score-hud">
            <div id="global-status" class="hud-label">CALCULATING...</div>
            <div id="global-score" class="big-number">--%</div>
            <div class="hud-label" style="color:var(--neon-blue)">INDICE DE STABILIT√â GLOBAL</div>
        </div>

        <div class="chart-wrapper"><canvas id="trendChart" height="300"></canvas></div>

<!-- ‚úÖ PRIME RADIANT 3D -->
<div class="radiant-3d-wrapper">
    <div class="radiant-3d-header">
        <span class="blink">‚ñà</span> PRIME RADIANT CORE ‚Äî VISUALISATION HOLOGRAPHIQUE
    </div>
    
    <div class="radiant-3d-container">
        <canvas id="prime-radiant-sphere"></canvas>
        
        <div class="radiant-controls">
            <button id="reset-view" class="radiant-btn">üîÑ RESET</button>
            <button id="toggle-rotation" class="radiant-btn">‚è∏Ô∏è PAUSE</button>
            <div class="radiant-info">
                <span id="event-count">0</span> √©v√©nements cartographi√©s
            </div>
        </div>
        
        <div id="event-tooltip" class="event-tooltip" style="display: none;">
            <div class="event-year"></div>
            <div class="event-score"></div>
            <div class="event-desc"></div>
        </div>
    </div>
    
    <div class="radiant-legend">
        <div class="legend-item">
            <span class="legend-dot" style="background: var(--neon-green);"></span>
            Stabilit√© √©lev√©e (60-100)
        </div>
        <div class="legend-item">
            <span class="legend-dot" style="background: var(--neon-yellow);"></span>
            Instabilit√© (40-59)
        </div>
        <div class="legend-item">
            <span class="legend-dot" style="background: var(--neon-red);"></span>
            Crise majeure (0-39)
        </div>
    </div>
</div>

<!-- Three.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="js/prime-radiant-3d.js"></script>
        <div class="terminal-box">
            <div class="terminal-header"><span class="blink">‚ñà</span> ANALYSE STRAT√âGIQUE DU NOYAU</div>
            <div id="analysis-text" class="analysis-text">Chargement...</div>
            <div id="container-crisis" style="display:none"><div class="alert-group-title" style="color:var(--gold);">üîÆ PROJECTION DU RADIANT</div><ul id="list-crisis" class="alerts-list"></ul></div>
            <div id="container-critical" style="display:none"><div class="alert-group-title" style="color:var(--neon-red);">üö® MENACES IMM√âDIATES</div><ul id="list-critical" class="alerts-list"></ul></div>
            <div id="container-warning" style="display:none"><div class="alert-group-title">‚ö†Ô∏è VIGILANCE</div><ul id="list-warning" class="alerts-list"></ul></div>
            <div id="container-info" style="display:none"><div class="alert-group-title">‚ÑπÔ∏è STABLE</div><ul id="list-info" class="alerts-list"></ul></div>
        </div>

        <div id="pillars-grid" class="grid"></div>
        
        <div class="archives-box">
            <div style="margin-bottom:15px; text-transform:uppercase; letter-spacing:2px; color:var(--neon-blue);">üìú Archives Historiques du Radiant</div>
            <div id="archives-list">Chargement des archives...</div>
        </div>

        <footer>PROJECTION GENERATED BY PSYCHOHISTORY_BOT // GITHUB ACTIONS<br>TERMINAL SESSION ID: 0X-SELDON-V31</footer>
    </div>

    <script>
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            const errorBox = document.getElementById('error-box'); 
            errorBox.style.display = 'block';
            errorBox.innerHTML += `<strong>‚õî ERREUR :</strong> ${msg}<br>Ligne: ${lineNo}<br>Fichier: ${url}<br><br>`; 
            console.error('Erreur d√©tect√©e:', msg, error);
            return false; 
        };

        const names = { 
            "energie": "‚ö° √âNERGIE", 
            "environnement": "üåç CLIMAT", 
            "espace": "üöÄ ESPACE", 
            "demographie_social": "üë• SOCIAL", 
            "sante_bio": "üß¨ BIO-SANT√â", 
            "geopolitique": "‚öîÔ∏è G√âOPOLITIQUE", 
            "technologie_ia": "ü§ñ TECH & IA", 
            "finance": "üí∞ FINANCE", 
            "information": "üß† NOOSPH√àRE" 
        };
        
        const definitions = { 
            "energie": "Indice de disponibilit√© √©nerg√©tique globale.", 
            "environnement": "√âtat d'int√©grit√© de la biosph√®re.", 
            "espace": "Vecteur d'expansion exosph√©rique.", 
            "demographie_social": "Coh√©sion du tissu social.", 
            "sante_bio": "R√©silience biologique.", 
            "geopolitique": "Tension tectonique.", 
            "technologie_ia": "Acc√©l√©ration technologique.", 
            "finance": "Fluidit√© des flux de cr√©dits.", 
            "information": "Hygi√®ne de la Noosph√®re." 
        };
        
        const alertTranslator = { 
            "Œ©_BIOSPHERE": "CLIMAT", 
            "Œ£_CONFLICT": "G√âOPOLITIQUE", 
            "Œî_SINGULARITY": "TECH & IA", 
            "Œ®_MASS": "SOCIAL", 
            "‚ö°_ENTROPY": "√âNERGIE", 
            "üìâ_CREDIT_FLOW": "FINANCE" 
        };

        async function calculateStability(pillars, weights) {
            let weightedSum = 0;
            let totalWeight = 0;
            
            for (const [key, data] of Object.entries(pillars)) {
                const score = (typeof data === 'object' && data.score) ? data.score : data;
                const weight = weights[key] || 1.0;
                
                weightedSum += score * weight;
                totalWeight += weight;
            }
            
            return Math.round(weightedSum / totalWeight);
        }

        async function loadData() {
            try {
                const time = new Date().getTime(); 
                let response_current = await fetch('data/current_state.json?v=' + time);
                const current = await response_current.json();
                
                // Charger les poids
                let response_weights = await fetch('data/weights.json?v=' + time);
                const weights = await response_weights.json();

                let history = [];
                try {
                    let response_hist = await fetch('data/recent_history.json?v=' + time);
                    if(response_hist.ok) history = await response_hist.json();
                    else {
                        let old_hist = await fetch('data/history_2020_2025.json');
                        history = await old_hist.json();
                    }
                } catch(e) { console.warn("Erreur historique", e); }

                let scenarios = {};
                try { 
                    let r = await fetch('data/projection_2036.json?v=' + time); 
                    if (r.ok) scenarios = (await r.json()).scenarios || {}; 
                } catch(e) {
                    console.warn("Erreur projections", e);
                }

                if(current.global_analysis) document.getElementById('analysis-text').textContent = current.global_analysis;

                const accEl = document.getElementById('model-accuracy');
                if (current.model_accuracy !== undefined) {
                    accEl.textContent = current.model_accuracy + "%";
                    if(current.model_accuracy > 90) accEl.style.color = "var(--neon-green)";
                    else if(current.model_accuracy > 70) accEl.style.color = "var(--neon-yellow)";
                    else accEl.style.color = "var(--neon-red)";
                } else { accEl.textContent = "N/A"; }

                const listCrisis = document.getElementById('list-crisis'); listCrisis.innerHTML = '';
                const listCrit = document.getElementById('list-critical'); listCrit.innerHTML = '';
                const listWarn = document.getElementById('list-warning'); listWarn.innerHTML = '';
                const listInfo = document.getElementById('list-info'); listInfo.innerHTML = '';
                let hasCrisis=false, hasCrit=false, hasWarn=false, hasInfo=false;

                if(current.alerts) {
                    current.alerts.forEach(alert => {
                        const li = document.createElement('li');
                        if (alert.includes("üìÖ")) {
                            let raw = alert.replace("üìÖ", "").trim(); let split = raw.indexOf(":");
                            let y = "FUTUR", m = raw; if(split !== -1) { y=raw.substring(0,split).trim(); m=raw.substring(split+1).trim(); }
                            li.className = 'alert-item alert-crisis';
                            li.innerHTML = `<span class="badge b-gold">${y}</span> <span style="font-style:italic; color:#ffd700;">"${m}"</span>`;
                            listCrisis.appendChild(li); hasCrisis = true;
                        } else if (alert.includes("SINGULARIT√â") || alert.includes("CLIMAT") || alert.includes("GUERRE") || alert.includes("Œ©_") || alert.includes("Œ£_") || alert.includes("Œî_") || alert.includes("DIVERGENCE")) {
                            li.className = 'alert-item alert-crit';
                            let t = alert; for(const [k,v] of Object.entries(alertTranslator)) if(t.includes(k)) t=t.replace(k,v);
                            li.innerHTML = `<span class="badge b-red">CRITIQUE</span> <span>${t.replace(/‚ö†Ô∏è|üî¥|‚öîÔ∏è|üìà|üî•/g, "").trim()}</span>`;
                            listCrit.appendChild(li); hasCrit = true;
                        } else if (alert.includes("STABLE") || alert.includes("‚úÖ")) {
                            li.className = 'alert-item alert-info'; li.innerHTML = `<span class="badge b-green">INFO</span> <span>${alert.replace(/‚úÖ/g, "")}</span>`;
                            listInfo.appendChild(li); hasInfo = true;
                        } else {
                            li.className = 'alert-item alert-warn'; li.innerHTML = `<span class="badge b-orange">WARN</span> <span>${alert.replace(/‚ö†Ô∏è|üìà|üìâ/g, "")}</span>`;
                            listWarn.appendChild(li); hasWarn = true;
                        }
                    });
                }
                document.getElementById('container-crisis').style.display = hasCrisis?'block':'none';
                document.getElementById('container-critical').style.display = hasCrit?'block':'none';
                document.getElementById('container-warning').style.display = hasWarn?'block':'none';
                document.getElementById('container-info').style.display = hasInfo?'block':'none';

                // ARCHIVES NARRATIVES
                const archivesDiv = document.getElementById('archives-list');
                if (current.archives && current.archives.length > 0) {
                    archivesDiv.innerHTML = "";
                    current.archives.forEach(arc => {
                        const div = document.createElement('div');
                        div.className = 'archive-item';
                        let desc = arc.desc ? arc.desc : "Donn√©e historique non classifi√©e.";
                        div.innerHTML = `
                            <span class="archive-year">${arc.year}</span>
                            <span class="archive-score">[${arc.score}%]</span>
                            <span class="archive-desc">${desc}</span>
                        `;
                        archivesDiv.appendChild(div);
                    });
                } else { archivesDiv.textContent = "Synchronisation des archives..."; }

                const histLabels = history.map(h => h.year);
                const histData = await Promise.all(history.map(async h => await calculateStability(h.pillars, weights)));
                const currentScore = current.stability_index;
                const labels = [...histLabels, "2026"];
                const dataCommon = [...histData, currentScore];
                if(scenarios.tendantielle) scenarios.tendantielle.forEach(p => labels.push(p.year));
                const emptyHist = new Array(dataCommon.length - 1).fill(null);
                const startP = currentScore;
                
                const datasets = [{ label: 'HISTORIQUE', data: [...dataCommon, ...new Array(labels.length - dataCommon.length).fill(null)], borderColor: '#fff', borderWidth: 3, tension: 0.4, pointRadius: 0 }];
                if (scenarios.tendantielle) {
                    let dOpt = [...emptyHist, startP]; scenarios.optimiste.forEach(p=>dOpt.push(p.stability_index));
                    datasets.push({ label: 'OPTIMISTE', data: dOpt, borderColor: '#00ff9d', borderDash: [5,5], borderWidth:2, pointRadius:0 });
                    let dTen = [...emptyHist, startP]; scenarios.tendantielle.forEach(p=>dTen.push(p.stability_index));
                    datasets.push({ label: 'TENDANCE', data: dTen, borderColor: '#00BFFF', borderDash: [2,2], borderWidth:3, pointRadius:0 });
                    let dPess = [...emptyHist, startP]; scenarios.pessimiste.forEach(p=>dPess.push(p.stability_index));
                    datasets.push({ label: 'EFFONDREMENT', data: dPess, borderColor: '#ff0055', borderDash: [5,5], borderWidth:2, pointRadius:0 });
                }

                if(window.myChart) window.myChart.destroy();
                Chart.defaults.color = '#555'; Chart.defaults.font.family = "'Share Tech Mono', monospace";
                window.myChart = new Chart(document.getElementById('trendChart'), { 
                    type:'line', 
                    data:{labels, datasets}, 
                    options:{ 
                        responsive:true, 
                        maintainAspectRatio:false, 
                        interaction:{mode:'index', intersect:false}, 
                        plugins:{ 
                            legend:{position:'bottom', labels:{usePointStyle:true, color:'#aaa', font:{family:'Orbitron', size:10}}}, 
                            tooltip:{callbacks:{label:c=>c.dataset.label+": "+c.raw+"%"}} 
                        }, 
                        scales:{ 
                            y:{grid:{color:'rgba(255,255,255,0.05)'}, beginAtZero:true, max:100}, 
                            x:{grid:{display:false}} 
                        } 
                    } 
                });

                document.getElementById('last-update').textContent = "DATA: " + current.date;
                document.getElementById('last-update').style.color = "var(--neon-green)";
                document.getElementById('last-update').style.borderColor = "var(--neon-green)";
                document.getElementById('global-score').textContent = currentScore + "%";
                updateEquations(current)
                const st = document.getElementById('global-status');
                
                if(currentScore>60) { st.textContent="SYSTEM STABLE"; st.style.color="var(--neon-green)"; }
                else if(currentScore>40) { st.textContent="SYSTEM UNSTABLE"; st.style.color="var(--neon-yellow)"; }
                else { st.textContent="CRITICAL FAILURE"; st.style.color="var(--neon-red)"; }

                const grid = document.getElementById('pillars-grid'); grid.innerHTML = '';
                for (const [key, val] of Object.entries(current.pillars)) {
                    let sVal = (typeof val === 'object' && val.score) ? val.score : val;
                    let com = (typeof val === 'object' && val.comment) ? val.comment : "";
                    let def = definitions[key] || "Donn√©e classifi√©e.";
                    if(com) def += "<br><hr style='border:0; border-top:1px solid #444; margin:8px 0;'>üëâ <em style='color:var(--neon-blue)'>" + com + "</em>";
                    let cv = Math.round(sVal);
                    let st = 'good'; if(cv<40) st='bad'; else if(cv<60) st='mid'; if(key==='technologie_ia' && cv>90) st='mid';
                    const c = document.createElement('div'); c.className = 'card';
                    c.innerHTML = `<div class="card-header"><div class="card-title-box"><span class="card-title">${names[key]||key}</span><div class="info-icon">?<div class="tooltip-data"><strong style="color:var(--neon-blue); text-transform:uppercase; display:block; margin-bottom:5px;">${names[key]} (${cv}%)</strong>${def}</div></div></div><span class="card-score c-${st}">${cv}%</span></div><div class="progress-container"><div class="progress-bar bg-${st}" style="width: ${cv}%"></div></div>`;
                    grid.appendChild(c);
                }
            } catch(e) { 
                console.error("Erreur dans loadData:", e);
                const errorBox = document.getElementById('error-box');
                errorBox.style.display = 'block';
                errorBox.innerHTML += `<strong>‚õî ERREUR CRITIQUE :</strong> ${e.message}<br>`;
                throw e; 
            }
        }
        
        loadData();

        const tb = document.createElement('div'); tb.id = 'floating-tooltip'; document.body.appendChild(tb);
        document.addEventListener('mouseover', e => { if(e.target.closest('.info-icon')) { const h = e.target.closest('.info-icon').querySelector('.tooltip-data'); if(h) { tb.innerHTML=h.innerHTML; tb.style.display='block'; moveTooltip(e); } } });
        document.addEventListener('mousemove', e => { if(tb.style.display==='block') moveTooltip(e); });
        document.addEventListener('mouseout', e => { if(e.target.closest('.info-icon')) tb.style.display='none'; });
        function moveTooltip(e) {
            const off=12, w=tb.offsetWidth, h=tb.offsetHeight, vw=window.innerWidth, vh=document.documentElement.clientHeight;
            let l=e.clientX+off, t=e.clientY+off;
            if(l+w>vw) l=e.clientX-w-off; if(t+h>vh) t=e.clientY-h-off;
            tb.style.left=l+'px'; tb.style.top=t+'px';
        }
    </script>
</body>
</html>
