<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seldon Project | DEBUG MODE</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <style>
        /* CSS DU RADIANT (Identique mais simplifié pour debug) */
        * { box-sizing: border-box; }
        body { background-color: #020205; color: #e0e0e0; font-family: 'Rajdhani', sans-serif; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { border-bottom: 2px solid #00f3ff; padding-bottom: 20px; margin-bottom: 20px; }
        h1 { color: #00f3ff; font-family: 'Orbitron'; margin: 0; }
        
        /* BOITE D'ERREUR */
        #error-box {
            display: none;
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid red;
            color: #fff;
            padding: 20px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .status-pill { border: 1px solid #00f3ff; padding: 5px 10px; color: #00f3ff; font-family: monospace; }
        
        /* Elements cachés si erreur */
        .content-wrapper { transition: 0.3s; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>SELDON DEBUG</h1>
            </div>
            <div id="last-update" class="status-pill">INITIALIZING...</div>
        </header>

        <div id="error-box"></div>

        <div class="content-wrapper">
            <div style="text-align:center; margin-bottom:20px;">
                <canvas id="trendChart" height="200"></canvas>
            </div>
            <div id="analysis-text">Chargement données...</div>
            <div id="pillars-grid"></div>
        </div>
    </div>

    <script>
        // --- MOUCHARD D'ERREUR (AFFICHE TOUT A L'ECRAN) ---
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            const errorBox = document.getElementById('error-box');
            const statusPill = document.getElementById('last-update');
            
            errorBox.style.display = 'block';
            errorBox.innerHTML = `<strong>⛔ ERREUR CRITIQUE DÉTECTÉE :</strong><br><br>` + 
                                 `Message: ${msg}<br>` +
                                 `Ligne: ${lineNo}<br>` +
                                 `Détail: ${error}`;
            
            statusPill.textContent = "CRASH SYSTÈME";
            statusPill.style.color = "red";
            statusPill.style.borderColor = "red";
            return false;
        };

        // --- SCRIPT PRINCIPAL ---
        const names = { "energie": "ENERGIE", "environnement": "CLIMAT", "geopolitique": "GEO", "technologie_ia": "TECH", "finance": "FINANCE", "demographie_social": "SOCIAL", "sante_bio": "BIO", "espace": "ESPACE", "information": "INFO" };

        async function loadData() {
            try {
                // 1. Test de connexion
                document.getElementById('last-update').textContent = "1/3 DOWNLOAD...";
                const time = new Date().getTime(); 
                
                // On essaie de charger JUSTE le fichier current pour voir
                const response = await fetch('data/current_state.json?v=' + time);
                
                if (!response.ok) {
                    throw new Error(`Fichier 'current_state.json' introuvable (Erreur ${response.status}). Le robot n'a pas généré les données.`);
                }

                document.getElementById('last-update').textContent = "2/3 PARSING...";
                const current = await response.json();

                // 2. Vérification de la structure
                if (!current.pillars) throw new Error("Le fichier JSON est vide ou mal formé (pas de 'pillars').");

                document.getElementById('last-update').textContent = "3/3 RENDERING...";
                
                // 3. Affichage basique pour tester
                document.getElementById('analysis-text').textContent = current.global_analysis || "Pas d'analyse.";
                
                const grid = document.getElementById('pillars-grid');
                grid.innerHTML = '';
                
                for (const [key, valueObj] of Object.entries(current.pillars)) {
                    let score = (typeof valueObj === 'object') ? valueObj.score : valueObj;
                    grid.innerHTML += `<div style="border:1px solid #444; padding:10px; margin-bottom:5px;">${names[key] || key}: ${Math.round(score)}%</div>`;
                }

                // 4. Si on arrive ici, c'est que ça marche
                document.getElementById('last-update').textContent = "SUCCÈS ✅";
                document.getElementById('last-update').style.color = "#00ff9d";
                document.getElementById('last-update').style.borderColor = "#00ff9d";

            } catch (error) {
                // On déclenche l'affichage de l'erreur
                window.onerror(error.message, "", "", "", error);
            }
        }
        
        loadData();
    </script>
</bod
    y>
</html>
